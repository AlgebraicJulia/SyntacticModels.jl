<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Undirected Wiring Diagrams · SyntacticModels.jl</title><meta name="title" content="Undirected Wiring Diagrams · SyntacticModels.jl"/><meta property="og:title" content="Undirected Wiring Diagrams · SyntacticModels.jl"/><meta property="twitter:title" content="Undirected Wiring Diagrams · SyntacticModels.jl"/><meta name="description" content="Documentation for SyntacticModels.jl."/><meta property="og:description" content="Documentation for SyntacticModels.jl."/><meta property="twitter:description" content="Documentation for SyntacticModels.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SyntacticModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">SyntacticModels.jl</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Undirected Wiring Diagrams</a><ul class="internal"><li><a class="tocitem" href="#Model-Headers"><span>Model Headers</span></a></li></ul></li><li><a class="tocitem" href="../decapodes_examples/">Decapodes</a></li><li><a class="tocitem" href="../composite_models_examples/">Composing Models</a></li></ul></li><li><a class="tocitem" href="../../api/">Library Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Undirected Wiring Diagrams</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Undirected Wiring Diagrams</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/SyntacticModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/SyntacticModels.jl/blob/main/docs/literate/uwd_examples.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Undirected-Wiring-Diagrams"><a class="docs-heading-anchor" href="#Undirected-Wiring-Diagrams">Undirected Wiring Diagrams</a><a id="Undirected-Wiring-Diagrams-1"></a><a class="docs-heading-anchor-permalink" href="#Undirected-Wiring-Diagrams" title="Permalink"></a></h1><p>To specify complex systems, you need to specify primitive models and a pattern of composition. This example shows you how to use Undirected Wiring Diagrams (UWDs) as a language for expressing patterns of composition. These diagrams are undirected, because they do not have inputs and outputs. UWDs are for systems that compose by sharing variables. They are not for systems that compose like functions, where output of a system is passed as input to another system. For systems that compose like functions, use Directed Wiring Diagrams.</p><pre><code class="language-julia hljs">using ..SyntacticModels
using ..SyntacticModels.SyntacticModelsBase
using ..SyntacticModels.AMR
using ..SyntacticModels.ASKEMUWDs

using Test
using JSON3
using Catlab.RelationalPrograms
using Catlab.WiringDiagrams
using Catlab.Graphics

draw(uwd) = to_graphviz(uwd, box_labels=:name, junction_labels=:variable)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">draw (generic function with 1 method)</code></pre><p>This example follows what in current catlab would be given as:</p><pre><code class="language-julia hljs">@relation (x:X, z:Z) where y:Y begin
  R(x,y)
  S(y,z)
  T(z,y,u)
end</code></pre><p>Eventually, we will update the <code>@relation</code> macro to use this ADT based representation. This will allow users to create syntactic UWDExprs from with an easy to write syntax embedded in Julia.</p><pre><code class="language-julia hljs">v1 = Typed(:x, :X)
v2 = Typed(:y, :Y)
v3 = Typed(:z, :Z)
v4 = Untyped(:u)
c = [v1, v3]
s = [Statement(:R, [v1,v2]),
  Statement(:S, [v2,v3]),
  Statement(:T, [v3,v2, v4])]
u = UWDExpr(c, s)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">{ R(x:X, y:Y)
  S(y:Y, z:Z)
  T(z:Z, y:Y, u) } where {x:X, z:Z}</code></pre><p>We can test that if we write the <code>UWDExpr</code> into a JSON string, then we get the same information when we read it. The <code>==</code> operator for MLStyle types is not correctly working for these types, I think because some type information is being lost.</p><pre><code class="language-julia hljs">s = JSON3.write(u)
ujson = JSON3.read(s, UWDTerm)
@test s == JSON3.write(ujson)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr32"><span class="sgr1">Test Passed</span></span></code></pre><p>The element type of the array changes when you go through JSON, even though type of the elements are the same.</p><pre><code class="language-julia hljs">typeof(ujson.statements), typeof(u.statements)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Vector{SyntacticModels.ASKEMUWDs.Statement}, Vector{SyntacticModels.ASKEMUWDs.Statement})</code></pre><p>One can construct a Catlab Relation diagram from this expression.</p><pre><code class="language-julia hljs">uwd = ASKEMUWDs.construct(RelationDiagram, u)</code></pre><div class="c-set">
<span class="c-set-summary">Catlab.Programs.RelationalPrograms.TypedUnnamedRelationDiagram{Symbol, Symbol, Symbol} {Box:3, Port:7, OuterPort:2, Junction:4, Type:0, Name:0, VarName:0}</span>
<table>
  <thead>
    <tr class = "header headerLastRow">
      <th class = "rowLabel" style = "font-weight: bold; text-align: right;">Box</th>
      <th style = "text-align: right;">name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td>
      <td style = "text-align: right;">R</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td>
      <td style = "text-align: right;">S</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td>
      <td style = "text-align: right;">T</td>
    </tr>
  </tbody>
</table>
<table>
  <thead>
    <tr class = "header headerLastRow">
      <th class = "rowLabel" style = "font-weight: bold; text-align: right;">Port</th>
      <th style = "text-align: right;">box</th>
      <th style = "text-align: right;">junction</th>
      <th style = "text-align: right;">port_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td>
      <td style = "text-align: right;">1</td>
      <td style = "text-align: right;">1</td>
      <td style = "text-align: right;">X</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td>
      <td style = "text-align: right;">1</td>
      <td style = "text-align: right;">3</td>
      <td style = "text-align: right;">Y</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td>
      <td style = "text-align: right;">2</td>
      <td style = "text-align: right;">3</td>
      <td style = "text-align: right;">Y</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td>
      <td style = "text-align: right;">2</td>
      <td style = "text-align: right;">2</td>
      <td style = "text-align: right;">Z</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td>
      <td style = "text-align: right;">3</td>
      <td style = "text-align: right;">2</td>
      <td style = "text-align: right;">Z</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td>
      <td style = "text-align: right;">3</td>
      <td style = "text-align: right;">3</td>
      <td style = "text-align: right;">Y</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">7</td>
      <td style = "text-align: right;">3</td>
      <td style = "text-align: right;">4</td>
      <td style = "text-align: right;">untyped</td>
    </tr>
  </tbody>
</table>
<table>
  <thead>
    <tr class = "header headerLastRow">
      <th class = "rowLabel" style = "font-weight: bold; text-align: right;">OuterPort</th>
      <th style = "text-align: right;">outer_junction</th>
      <th style = "text-align: right;">outer_port_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td>
      <td style = "text-align: right;">1</td>
      <td style = "text-align: right;">x</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td>
      <td style = "text-align: right;">2</td>
      <td style = "text-align: right;">z</td>
    </tr>
  </tbody>
</table>
<table>
  <thead>
    <tr class = "header headerLastRow">
      <th class = "rowLabel" style = "font-weight: bold; text-align: right;">Junction</th>
      <th style = "text-align: right;">junction_type</th>
      <th style = "text-align: right;">variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td>
      <td style = "text-align: right;">X</td>
      <td style = "text-align: right;">x</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td>
      <td style = "text-align: right;">Z</td>
      <td style = "text-align: right;">z</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td>
      <td style = "text-align: right;">Y</td>
      <td style = "text-align: right;">y</td>
    </tr>
    <tr>
      <td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td>
      <td style = "text-align: right;">untyped</td>
      <td style = "text-align: right;">u</td>
    </tr>
  </tbody>
</table>
</div>
<p>And then use Graphviz to draw the uwd.</p><pre><code class="language-julia hljs">draw(uwd)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="175pt" height="164pt"
 viewBox="0.00 0.00 174.73 164.47" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 160.47)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-160.47 170.73,-160.47 170.73,4 -4,4"/>
<!-- n1 -->
<g id="box1" class="node">
<title>n1</title>
<ellipse fill="none" stroke="black" cx="48.9" cy="-101.15" rx="18" ry="18"/>
<text text-anchor="middle" x="48.9" y="-97.45" font-family="Serif" font-size="14.00">R</text>
</g>
<!-- n6 -->
<!-- junction -->
<g id="junction1" class="node">
<title>n6</title>
<ellipse fill="black" stroke="black" cx="22.67" cy="-127.07" rx="2.5" ry="2.5"/>
<text text-anchor="middle" x="15.67" y="-133.37" font-family="Serif" font-size="14.00">x</text>
</g>
<!-- n1&%2345;&%2345;n6 -->
<g id="edge1" class="edge">
<title>n1&%2345;&%2345;n6</title>
<path fill="none" stroke="black" d="M36.1,-113.8C31.73,-118.12 27.31,-122.49 24.79,-124.97"/>
</g>
<!-- n8 -->
<!-- junction -->
<g id="junction3" class="node">
<title>n8</title>
<ellipse fill="black" stroke="black" cx="78.56" cy="-76.78" rx="2.5" ry="2.5"/>
<text text-anchor="middle" x="71.56" y="-83.08" font-family="Serif" font-size="14.00">y</text>
</g>
<!-- n1&%2345;&%2345;n8 -->
<g id="edge6" class="edge">
<title>n1&%2345;&%2345;n8</title>
<path fill="none" stroke="black" d="M63.04,-89.53C68.29,-85.22 73.66,-80.81 76.5,-78.47"/>
</g>
<!-- n2 -->
<g id="box2" class="node">
<title>n2</title>
<ellipse fill="none" stroke="black" cx="118.73" cy="-84.08" rx="18" ry="18"/>
<text text-anchor="middle" x="118.73" y="-80.38" font-family="Serif" font-size="14.00">S</text>
</g>
<!-- n7 -->
<!-- junction -->
<g id="junction2" class="node">
<title>n7</title>
<ellipse fill="black" stroke="black" cx="130.5" cy="-45.39" rx="2.5" ry="2.5"/>
<text text-anchor="middle" x="124" y="-51.69" font-family="Serif" font-size="14.00">z</text>
</g>
<!-- n2&%2345;&%2345;n7 -->
<g id="edge3" class="edge">
<title>n2&%2345;&%2345;n7</title>
<path fill="none" stroke="black" d="M124.07,-66.55C126.26,-59.35 128.55,-51.82 129.72,-47.98"/>
</g>
<!-- n2&%2345;&%2345;n8 -->
<g id="edge7" class="edge">
<title>n2&%2345;&%2345;n8</title>
<path fill="none" stroke="black" d="M100.99,-80.86C93.26,-79.45 85.06,-77.96 81.05,-77.23"/>
</g>
<!-- n3 -->
<g id="box3" class="node">
<title>n3</title>
<ellipse fill="none" stroke="black" cx="90.23" cy="-37.82" rx="18" ry="18"/>
<text text-anchor="middle" x="90.23" y="-34.12" font-family="Serif" font-size="14.00">T</text>
</g>
<!-- n3&%2345;&%2345;n7 -->
<g id="edge4" class="edge">
<title>n3&%2345;&%2345;n7</title>
<path fill="none" stroke="black" d="M108.01,-41.16C115.77,-42.62 123.99,-44.17 128.01,-44.92"/>
</g>
<!-- n3&%2345;&%2345;n8 -->
<g id="edge8" class="edge">
<title>n3&%2345;&%2345;n8</title>
<path fill="none" stroke="black" d="M84.94,-55.48C82.77,-62.72 80.5,-70.31 79.34,-74.18"/>
</g>
<!-- n9 -->
<!-- junction -->
<g id="junction4" class="node">
<title>n9</title>
<ellipse fill="black" stroke="black" cx="73.29" cy="-2.5" rx="2.5" ry="2.5"/>
<text text-anchor="middle" x="65.79" y="-8.8" font-family="Serif" font-size="14.00">u</text>
</g>
<!-- n3&%2345;&%2345;n9 -->
<g id="edge9" class="edge">
<title>n3&%2345;&%2345;n9</title>
<path fill="none" stroke="black" d="M82.36,-21.4C79.32,-15.06 76.17,-8.5 74.5,-5.03"/>
</g>
<!-- n4 -->
<!-- n4&%2345;&%2345;n6 -->
<g id="edge2" class="edge">
<title>n4&%2345;&%2345;n6</title>
<path fill="none" stroke="black" d="M1.05,-155.25C3.82,-151.64 16.36,-135.29 20.97,-129.29"/>
</g>
<!-- n5 -->
<!-- n5&%2345;&%2345;n7 -->
<g id="edge5" class="edge">
<title>n5&%2345;&%2345;n7</title>
<path fill="none" stroke="black" d="M165.35,-32.09C160.88,-33.79 140.67,-41.51 133.25,-44.35"/>
</g>
</g>
</svg>
'/><h2 id="Model-Headers"><a class="docs-heading-anchor" href="#Model-Headers">Model Headers</a><a id="Model-Headers-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Headers" title="Permalink"></a></h2><p>As usual, we can add an AMR header to a UWD Model:</p><pre><code class="language-julia hljs">h = AMR.Header(&quot;rst_relation&quot;, &quot;modelreps.io/UWD&quot;, &quot;A demo UWD showing generic relation composition&quot;, &quot;UWDExpr&quot;, &quot;v0.1&quot;)
mexpr = UWDModel(h, u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;&quot;&quot;
ASKE Model Representation: rst_relationv0.1 :: UWDExpr 
   modelreps.io/UWD

A demo UWD showing generic relation composition
&quot;&quot;&quot;
UWD:
{ R(x:X, y:Y)
  S(y:Y, z:Z)
  T(z:Z, y:Y, u) } where {x:X, z:Z}</code></pre><p>And write that model in JSON</p><pre><code class="language-julia hljs">s = JSON3.write(mexpr)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;{\&quot;uwd\&quot;:{\&quot;statements\&quot;:[{\&quot;variables\&quot;:[{\&quot;var\&quot;:\&quot;x\&quot;,\&quot;type\&quot;:\&quot;X\&quot;,\&quot;_type\&quot;:\&quot;Typed\&quot;},{\&quot;var\&quot;:\&quot;y\&quot;,\&quot;type\&quot;:\&quot;Y\&quot;,\&quot;_type\&quot;:\&quot;Typed\&quot;}],\&quot;_type\&quot;:\&quot;Statement\&quot;,\&quot;relation\&quot;:\&quot;R\&quot;},{\&quot;variables\&quot;:[{\&quot;var\&quot;:\&quot;y\&quot;,\&quot;type\&quot;:\&quot;Y\&quot;,\&quot;_type\&quot;:\&quot;Typed\&quot;},{\&quot;var\&quot;:\&quot;z\&quot;,\&quot;type\&quot;:\&quot;Z\&quot;,\&quot;_type\&quot;:\&quot;Typed\&quot;}],\&quot;_type\&quot;:\&quot;Statement\&quot;,\&quot;relati&quot; ⋯ 216 bytes ⋯ &quot;\&quot;},{\&quot;var\&quot;:\&quot;z\&quot;,\&quot;type\&quot;:\&quot;Z\&quot;,\&quot;_type\&quot;:\&quot;Typed\&quot;}],\&quot;_type\&quot;:\&quot;UWDExpr\&quot;},\&quot;header\&quot;:{\&quot;description\&quot;:\&quot;A demo UWD showing generic relation composition\&quot;,\&quot;name\&quot;:\&quot;rst_relation\&quot;,\&quot;_type\&quot;:\&quot;Header\&quot;,\&quot;model_version\&quot;:\&quot;v0.1\&quot;,\&quot;schema\&quot;:\&quot;modelreps.io/UWD\&quot;,\&quot;schema_name\&quot;:\&quot;UWDExpr\&quot;},\&quot;_type\&quot;:\&quot;UWDModel\&quot;}&quot;</code></pre><p>Just as check, the headers should be preserved.</p><pre><code class="language-julia hljs">@test JSON3.write(JSON3.read(s, UWDModel)) == JSON3.write(mexpr)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr32"><span class="sgr1">Test Passed</span></span></code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« SyntacticModels.jl</a><a class="docs-footer-nextpage" href="../decapodes_examples/">Decapodes »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Monday 30 October 2023 14:03">Monday 30 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
